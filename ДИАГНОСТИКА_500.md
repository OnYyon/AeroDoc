# Диагностика ошибки 500 при регистрации

## Шаг 1: Проверьте логи Backend

**ВАЖНО:** Откройте терминал, где запущен backend, и посмотрите, что там выводится при попытке регистрации.

Должны быть видны сообщения типа:
- `Попытка регистрации пользователя: ...`
- `Ошибка при регистрации: ...`

**Скопируйте текст ошибки из терминала backend!**

## Шаг 2: Запустите скрипт диагностики

Откройте терминал в директории `backend` и выполните:

```bash
python debug_register.py
```

Этот скрипт проверит:
- Подключение к базе данных
- Существование таблиц
- Работу модели User
- Хеширование паролей
- Валидацию ролей

**Сообщите, что выводит этот скрипт!**

## Шаг 3: Проверьте состояние сервера

Откройте в браузере: **http://localhost:8000/api/health**

Должен вернуться JSON:
```json
{
  "status": "ok",
  "database": "connected",
  "tables_created": true
}
```

Если `tables_created: false`, значит таблицы не созданы.

## Шаг 4: Инициализируйте базу данных

Если таблицы не созданы, выполните:

```bash
cd backend
python init_db.py
```

Должно вывести:
```
✓ Таблицы успешно созданы!
✓ База данных готова к использованию
```

## Шаг 5: Проверьте консоль браузера

1. Откройте браузер (F12)
2. Перейдите на вкладку **Console**
3. Попробуйте зарегистрироваться
4. Посмотрите, какие ошибки выводятся

Также проверьте вкладку **Network**:
1. Найдите запрос к `/api/auth/register`
2. Кликните на него
3. Посмотрите вкладку **Response** - там должен быть текст ошибки от сервера

## Частые проблемы и решения

### Проблема: "no such table: users"

**Решение:**
```bash
cd backend
python init_db.py
```

Затем перезапустите backend.

### Проблема: "bcrypt" не установлен

**Решение:**
```bash
pip install bcrypt
```

### Проблема: Ошибка валидации роли

**Решение:**
Убедитесь, что в форме регистрации выбрана одна из доступных ролей:
- engineer
- technician
- quality_control
- project_manager
- maintenance
- admin

### Проблема: База данных заблокирована

**Решение:**
1. Остановите backend (Ctrl+C)
2. Удалите файл `backend/aerodoc.db`
3. Запустите `python init_db.py`
4. Запустите backend заново

## Что делать дальше

После выполнения всех шагов:

1. **Скопируйте логи из терминала backend** (все сообщения, которые выводятся при попытке регистрации)
2. **Скопируйте ответ из Network → Response** в браузере
3. **Сообщите результат выполнения `debug_register.py`**

Это поможет точно определить причину ошибки.

